(function(){$(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;return d={TIME:30,LIFE:5,SHOW_TIME:2e3,PREPARED_QUESTION_NUM:5},h=function(){function a(){}return a.prototype.getRandomInt=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},a.prototype.strip=function(a){var b;return b=document.createElement("DIV"),b.innerHTML=a,b.textContent||b.innerText||""},a.prototype.shuffle=function(a){var b,c,d;for(c=void 0,d=void 0,b=a.length;b;)c=Math.floor(Math.random()*b),d=a[--b],a[b]=a[c],a[c]=d;return a},a}(),l=function(){function a(a,c){null==c&&(c=0),b=a,g=c,f=0}var b,c,d,e,f,g;return b=void 0,g=void 0,f=void 0,c=1,a.prototype.reset=function(){c=1,g=0,f=0},a.prototype.getRound=function(){return f},a.prototype.getScore=function(){return g},e=function(a){null==a&&(a=1),g+=a},a.prototype.resetCombo=function(){return c=1},d=function(a){null==a&&(a=1),f+=a},a.prototype.win=function(){return e(c++),d()},a}(),i=function(){function a(a,b){null==b&&(b=c),d=a,e=this,f=b,e.updateView(f)}var b,c,d,e,f,g;return c=5,d=void 0,e=void 0,g=5,f=void 0,b=$("#heart"),a.prototype.minus=function(a){return null==a&&(a=1),f-=a,e.updateView(f),f},a.prototype.setLife=function(a){return null==a&&(a=c),f=a,e.updateView(f)},a.prototype.updateView=function(a){var b,c,e,f,h,i,j;for(b=$("#heart .heartCell"),j=[],f=h=0,i=g;i>=0?i>h:h>i;f=i>=0?++h:--h)a>f?j.push(b.eq(f).toggleClass("hurt",!1)):(c=b.eq(f),c.hasClass("hurt")||0!==a||(e=!1,c.one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(a){return e?void 0:(d.lose("die"),e=!0)})),j.push(c.toggleClass("hurt",!0)));return j},a}(),m=function(){function a(a){e=a,f=this}var b,c,e,f,g,h,i;return e=void 0,f=void 0,c=$("#time"),b=$("#timeText"),h=void 0,i=void 0,g=function(){h-=1,b.text(h),0===h?e.timeout():(5===h&&e.timing(),i=setTimeout(g,1e3))},a.prototype.start=function(a){return null==a&&(a=d.TIME),f.stop(),h=a+1,g(),$("#timeText").removeClass("red")},a.prototype.reStart=function(a){return null!=a&&(h=a+1),f.stop(),g()},a.prototype.stop=function(){return null!=i?clearTimeout(i):void 0},a.prototype.remainTime=function(){return h},a}(),k=function(){function a(a,b){d=a,e=this}var b,c,d,e,f,g,h,i;return e=void 0,d=void 0,b=$("#question"),c=$("#sound"),f=void 0,i=void 0,g={_ansWord:void 0,_ansPron:void 0,_ansIndex:void 0},h=function(a,b,c){var d,e,f,g,h,i;for(d="",h=a.split(""),e=f=0,g=h.length;g>f;e=++f)i=h[e],d+='<div class="circle qWordCon qWordConAns">\n  <div class="inner">\n    <span class="qWord">'+(e!==c?i:"*")+'</span>\n    <span class="qPron">'+(e!==c?b[e]:"...")+"</span>\n  </div>\n</div>";return d},a.prototype.showAnsWord=function(){var a;return a=$(".qWordCon").eq(g._ansIndex).find(".qWord").text(g._ansWord).addClass("red"),e.showAnsPron()},a.prototype.showAnsPron=function(){var a;return a=$(".qWordCon").eq(g._ansIndex).find(".qPron").text(g._ansPron).addClass("red")},a.prototype.refresQuestion=function(a,c,d,e){var f;return g._ansIndex=d,g._ansWord=a.charAt(d),g._ansPron=c[d],f=b.find(".qWordCon"),$.when(f.fadeOut()).done(function(){return f.remove(),$(h(a,c,d)).appendTo(b),"function"==typeof e?e():void 0})},a}(),f=function(){function a(a){d=a,e=this}var c,d,e,f,g,h;return d=void 0,e=void 0,f=void 0,c=$("#ballonCon"),g=function(a,b){var c;return c=null!=a?!0:!1,'<div class="col-md-2 ballon broke" data-index="'+b+'" data-hasWord="'+c+'">\n  <span>'+(null!=a?a:"")+"</span>\n</div>"},h=function(a){var c;return c=b.shuffle(a)},a.prototype.half=function(){var a,d,e,g,h,i,j;for(a=c.find(".ballon"),h=a.length,g=Math.floor(h/2),d=b.shuffle(function(){i=[];for(var a=0;h>=0?h>=a:a>=h;h>=0?a++:a--)i.push(a);return i}.apply(this)),e=[];e.length!==g;)j=d.shift(),j!==f&&e.push(j);return a.each(function(a,b){var c;return c=$(this),-1!==e.indexOf(parseInt(c.data("index")))?c.addClass("broke"):void 0})},a.prototype.checkAnswer=function(a){var b;return b=a===f},a.prototype.refreshBoard=function(a,b){var d;return f=void 0,d=h(b),f=b.indexOf(a),e.destruct(function(){var a,b,e,f,h;for(b=e=0,f=d.length;f>e;b=++e)h=d[b],a=g(h,b),$(a).appendTo(c);return setTimeout(function(){return c.find(".ballon").removeClass("broke")},100)})},a.prototype.destruct=function(a){var b;return b=c.find(".col-md-2"),0!==b.length?(setTimeout(function(){return b.remove(),null!=a?a():void 0},800),$("#ballonCon .ballon").addClass("broke")):null!=a?a():void 0},a}(),e=function(){function a(a){g=a,d[0].load(),f[0].load()}var b,c,d,e,f,g;return g=void 0,b=$("#sound"),d=$("#audio_o"),f=$("#audio_x"),e=$("#audio_t"),c=$("#sound_src"),a.prototype.refreshSrc=function(a){return c.attr("src",a),b[0].pause(),b[0].load()},a.prototype.play=function(a){switch(a){case"question":return b[0].play();case"o":return d[0].play();case"x":return f[0].play();case"timing":return e[0].currentTime=3,e[0].play()}},a.prototype.stop=function(a){var c;switch(c=void 0,a){case"question":c=b[0];break;case"o":c=d[0];break;case"x":c=f[0];break;case"timing":c=e[0]}return c.pause(),c.currentTime=0},a.prototype.checkSrc=function(){return c.attr("src").length>3},a}(),g=function(){function a(a){d=this,c=a,h()}var c,d,e,f,g,h;return d=void 0,c=void 0,h=function(){return jQuery.ajax=function(a){var b,c,d,e,f,g;return f=location.protocol,d=location.hostname,c=RegExp(f+"//"+d),b="http"+(/^https/.test(f)?"s":"")+"://query.yahooapis.com/v1/public/yql?callback=?",g='select * from html where url="{URL}" and xpath="*"',e=function(a){return!c.test(a)&&/:\/\//.test(a)},function(c){var d;return d=c.url,/get/i.test(c.type)&&!/json/i.test(c.dataType)&&e(d)&&(c.url=b,c.dataType="json",c.data={q:g.replace("{URL}",d+(c.data?(/\?/.test(d)?"&":"?")+jQuery.param(c.data):"")),format:"xml"},!c.success&&c.complete&&(c.success=c.complete,delete c.complete),c.success=function(a){return function(b){a&&a.call(this,{responseText:(b.results[0]||"").replace(/<script[^>]+?\/>|<script(.|\s)*?\/script>/gi,"")},"success")}}(c.success)),a.apply(this,arguments)}}(jQuery.ajax)},a.prototype.prepareQuestion=function(a){var b,c;return c={},b=function(b){return b?a(!1):null!=a&&null!=c.optionList&&null!=c.audioUrl?a(c):void 0},d.getQuestion(function(a){return c.question=a.question,c.pronounce=a.pArr,c.qIndex=a.qIndex,c.answerWord=a.qArr[a.qIndex],d.getOptionList(c.answerWord,a.pArr[a.qIndex],function(a){return a.length<20,c.optionList=a,b()}),d.getMp3New(a.question,function(e){return e.length>2?(c.audioUrl=e,b()):d.getMp3(a.question,function(a){return a.length<2?b(!0):(c.audioUrl=a,b())})})})},g=function(a){var c,d,e;return e=a,0===e.length&&(e="風水:hong-suí"),c=e.split(":"),d={question:c[0],qArr:c[0].split(""),pArr:c[1].split("-"),len:c[0].length,qIndex:b.getRandomInt(0,c[0].length-1)}},a.prototype.getQuestion=function(a){return $.ajax({type:"get",dataType:"text",url:"../q/get_question/",success:function(b,c){return"function"==typeof a?a(g(b)):void 0},error:function(a){return void 0}})},f=function(a,b){var c,d;for(0===a.length&&(a="金,天,氣,不,錯,只,是,有,一,點,飄,雨"),c=a.split(",");-1!==(d=c.indexOf(b));)c.splice(d,1);for(;-1!==(d=c.indexOf(""));)c.splice(d,1);return c=c.slice(0,19),c.push(b),c},a.prototype.getOptionList=function(a,b,c){return $.ajax({type:"get",dataType:"text",url:"../q/close_pronounce/"+b+"/",success:function(b,d){var e,g;return g=b,e=f(g,a),"function"==typeof c?c(e):void 0},error:function(){return void 0}})},a.prototype.getMp3=function(a,b){return $.ajax({type:"get",dataType:"text",url:"http://vois3.cyberon.com.tw/cloud_tts/gen_tts_file.php",data:{esl_f0:"1",esl_gain:"1",esl_speaker:"1",esl_speed:"1",f0:"1",gain:"1",language:"zh-NAN",outfmt:"mp3",punctuDuration:'{"，":0.5,"。":1}',speaker:"YiChuen",speed:"1",text:a,vbr_quality:"1"},error:function(a){return void 0},success:function(a,c){var d;return d=e(a),b(d)}})},a.prototype.getMp3New=function(a,b){var c;return c="/game/music/"+encodeURIComponent(a)+".wav",$.ajax({type:"get",contentType:"audio/wav",url:c,error:function(a){return void 0},success:function(a,d){return b(a.length>6?c:"")}})},e=function(a){var b,c,d,e;return d=a.responseText,b=d.search("http:"),c=d.search("}"),e=d.slice(b,c-1),e=e.replace(/\\/g,"")},a}(),j=function(){function a(a){g=this,f=a,$("#startBtn").css("opacity",.7).prop("disabled",!0),d.modal({backdrop:"static"}),b.show=function(a,c,d){return b.find(".how").text(a),b.find(".score").text(c),b.find(".round").text(d),b.modal({backdrop:"static",keyboard:!1})}}var b,c,d,e,f,g,h,i;return g=void 0,f=void 0,d=$("#startModal"),b=$("#loseModal"),e=$("#winModal"),c=$("#hint > span.round"),$(document).on("click","#loseModal .restart",function(){return b.modal("hide"),f.newGame()}),$(document).on("click","#startBtn",function(){return f.newGame(),d.modal("hide")}),h=["零","壹","貳","叄","肆","伍","陸","柒","捌","玖","拾"],i=function(a){var b,c,d,e,f,g;for(e=a.toString(),b=e.split(""),f=[],c=0,d=b.length;d>c;c++)g=b[c],f.push(h[g]);return f.join("")},a.prototype.showRound=function(a){return c.text(i(a))},a.prototype.$winModal=e,a.prototype.$loseModal=b,a}(),a=function(){function a(){t=this,x(t),t.prepareQuesiton(function(){return $("#startBtn").css("opacity",1).prop("disabled",!1)})}var b,h,n,o,p,q,r,s,t,u,v,w,x,y,z,A;return t=void 0,o=void 0,r=void 0,n=void 0,h=void 0,u=void 0,p=void 0,s=void 0,q=void 0,v={},A=[],z=!1,y={round:1,prepared:!0},w=function(){return $(".funcBtn").removeClass("used"),v={half:!0,pron:!0,skip:!0}},x=function(a){return o=new g(a),r=new k(a),n=new f(a),h=new e(a),u=new m(a),p=new i(a),s=new l(a),q=new j(a),t.Audio=h,t.Page=q},a.prototype.prepareQuesiton=function(a){var b,c,e,f,g;if(A.length<d.PREPARED_QUESTION_NUM){for(g=[],b=c=e=A.length,f=d.PREPARED_QUESTION_NUM;f>=e?f>c:c>f;b=f>=e?++c:--c)g.push(o.prepareQuestion(function(b){return b?(A.push(b),null!=a?(a(),a=void 0):void 0):t.prepareQuesiton(a)}));return g}},a.prototype.nextQuestion=function(){var a,b;return b=y.round,0!==A.length?(a=A.shift(),t.prepareQuesiton(),u.start(),n.refreshBoard(a.answerWord,a.optionList),q.showRound(y.round++),h.refreshSrc(a.audioUrl),r.refresQuestion(a.question,a.pronounce,a.qIndex,function(){return h.play("question"),y.prepared=!0})):void t.prepareQuesiton(function(){return t.nextQuestion()})},a.prototype.playSound=function(){return h.checkSrc()?(h.play("question"),!0):!1},a.prototype.hint=function(a){var b;if(b=v[a])switch(v[a]=!1,a){case"half":n.half();break;case"skip":u.stop(),c.nextQuestion();break;case"pron":r.showAnsPron()}return b},a.prototype.timing=function(){return h.play("timing"),$("#timeText").addClass("red")},a.prototype.timeout=function(){var a;return y.prepared=!1,u.stop(),r.showAnsWord(),h.play("x"),$("#timeup").fadeIn(),a=p.minus(1),setTimeout(function(){return 0!==a&&c.nextQuestion(),$("#timeup").fadeOut()},d.SHOW_TIME)},a.prototype.wrongAns=function(){var a;return y.prepared=!1,u.stop(),h.play("x"),r.showAnsWord(),$("#x").fadeIn(),a=p.minus(1),s.resetCombo(),setTimeout(function(){return 0!==a&&c.nextQuestion(),$("#x").fadeOut()},d.SHOW_TIME)},a.prototype.rightAns=function(){return y.prepared=!1,u.stop(),r.showAnsWord(),h.play("o"),$("#o").fadeIn(),s.win(),setTimeout(function(){return $("#o").fadeOut(),c.nextQuestion()},d.SHOW_TIME)},a.prototype.newGame=function(){return z?void 0:(y.round=1,t.nextQuestion(),w(),p.setLife(d.LIFE),s.reset(),z=!0)},a.prototype.checkAnswer=function(a){return n.checkAnswer(a)},a.prototype.lose=function(a){var b;switch(z=!1,b=void 0,u.stop(),a){case"die":b="你失去所有生命值..";break;case"timeout":b="你沒有在時間內完成答題.."}return q.$loseModal.show(b,s.getScore(),s.getRound())},b=$(document),b.on("click",".ballon",function(){var a;if(y.prepared!==!1)return y.prepared=!1,a=$(this),a.hasClass("broke")?!1:(a.addClass("broke"),h.stop("timing"),a.data("hasword")===!0?c.checkAnswer(a.data("index"))?c.rightAns():c.wrongAns():void 0)}),b.on("click",".funcBtn",function(){return y.prepared!==!1?c.hint($(this).data("func"))?$(this).addClass("used"):alert("這功能你已經用過了喔"):void 0}),b.on("click",".soundClickSpan",function(){return y.prepared!==!1?c.playSound()?void 0:alert("後端抓不到發音的音訊"):void 0}),a}(),b=new h,c=new a})}).call(this);